**React 渲染原理：Render 和 Commit 阶段详解**

React 的渲染过程分为两个主要阶段：Render 阶段和 Commit 阶段。这种分离使得 React 能够实现高效的更新和渲染优化。

整体流程：`触发更新 → Render 阶段 → Commit 阶段 → 浏览器绘制`

**Render阶段（协调阶段）**
1. 主要工作：（1）计算工作，通过对比新旧虚拟dom树（React Element 树），来确定需要更新的部分；（2）创建Fiber树，构建或更新Fiber节点树（React 的内部数据结构）；（3）调度优先级，根据更新的优先级决定处理顺序。
2. 关键特点：（1）可中断：React可以暂停、中止、或重用这个阶段的工作（2）无副作用：这个阶段不会直接修改dom（3）递归处理：采用深度优先遍历方式处理组件树。
3. 详细过程：（1）开始 遍历，从根节点开始处理，（2）协调算法（Diffing）比较新旧FIber节点，复用可复用的节点，标记需要插入、更新、或删除的节点；（3）生命周期调用：调用函数组件的函数体，调用类组件的render方法，执行getDerivedStateFromProps 等生命周期。（4）生成Effect List：标记有副作用的节点。

**Commit阶段**
1. 主要工作：（1）执行dom操作：实际应用所有更新到dom，（2）调用生命周期：执行副作用相关的生命周期方法和Hook，（3）更新refs: 更新所有ref引用；
2. 关键特点：（1）不可中断：必须一次性完成所有dom更新；（2）同步执行：快速完成以避免视觉不一致；（3）分为三个子阶段：Before mutation（突变前），Mutation（突变），Layout（布局）；
3. 详细过程：（1）Before mutation 阶段；（2）Mutation 阶段；（3）Layout 阶段
