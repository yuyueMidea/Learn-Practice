一个真实可用的企业级审批系统。以下是详细的技术文档：

📁 系统架构层次

```
┌─────────────────────────────────────────────────┐
│          ApprovalFlowSystem (主应用)              │
├─────────────────────────────────────────────────┤
│                                                 │
│  ┌──────────────────────────────────────────┐  │
│  │      Database (数据管理层)                 │  │
│  │  - users (用户数据)                        │  │
│  │  - workflows (流程定义)                    │  │
│  │  - instances (审批实例)                    │  │
│  │  - currentUser (当前登录用户)              │  │
│  └──────────────────────────────────────────┘  │
│                                                 │
│  ┌──────────────────────────────────────────┐  │
│  │      业务逻辑层                             │  │
│  │  - 流程创建与保存                           │  │
│  │  - 审批实例创建                             │  │
│  │  - 审批流转处理                             │  │
│  │  - 条件判断引擎                             │  │
│  └──────────────────────────────────────────┘  │
│                                                 │
│  ┌──────────────────────────────────────────┐  │
│  │      UI 组件层                              │  │
│  │  - NodeEditor (节点编辑器)                 │  │
│  │  - ConditionEditor (条件配置器)            │  │
│  │  - FlowVisualization (流程可视化)          │  │
│  │  - ApprovalProgress (审批进度)             │  │
│  │  - ApprovalList (审批列表)                 │  │
│  │  - CreateApplicationForm (申请表单)        │  │
│  │  - UserSelector (用户选择器)               │  │
│  └──────────────────────────────────────────┘  │
│                                                 │
└─────────────────────────────────────────────────┘
```

1. Database 类（模拟数据库）
```
class Database {
  users          // 用户列表（7个测试用户）
  workflows      // 流程定义列表
  instances      // 审批实例列表
  currentUser    // 当前登录用户
  
  // 核心方法
  - getUsers()                    // 获取所有用户
  - getCurrentUser()              // 获取当前用户
  - setCurrentUser(userId)        // 切换用户
  - saveWorkflow(workflow)        // 保存流程
  - createInstance(workflowId, formData)  // 创建审批实例
  - processApproval(instanceId, action, comment) // 处理审批
  - checkConditions(conditions, formData)  // 条件判断引擎
  - getMyPendingApprovals()       // 获取待我审批
  - getMyApplications()           // 获取我的申请
}
```

2. Workflow（流程定义）

```
{
  id: string,           // 流程ID
  name: string,         // 流程名称
  type: string,         // 申请类型
  nodes: Array,         // 节点列表
  createTime: string    // 创建时间
}
```

3. Instance（审批实例）

```
{
  id: string,               // 实例ID
  workflowId: string,       // 所属流程ID
  workflowName: string,     // 流程名称
  applicant: User,          // 申请人
  formData: Object,         // 表单数据
  status: ApprovalStatus,   // 当前状态
  currentNodeIndex: number, // 当前节点索引
  createTime: string,       // 创建时间
  history: Array            // 审批历史
}
```

4. Node（流程节点）

```
{
  id: string,          // 节点ID
  name: string,        // 节点名称
  type: NodeType,      // 节点类型
  assignees: Array,    // 审批人列表
  conditions: Array,   // 流转条件
  actions: Array,      // 可执行操作
  order: number        // 排序序号
}
```

---

## 🔄 业务流程逻辑

### **流程 1: 创建并保存审批流程**
```
用户输入流程名称
  ↓
添加审批节点
  ↓
配置每个节点的审批人
  ↓
设置流转条件（可选）
  ↓
预览流程
  ↓
保存到 Database
```

### **流程 2: 发起审批申请**
```
选择流程模板
  ↓
填写申请表单
  - 标题、类型、金额、说明等
  ↓
提交申请
  ↓
创建审批实例（Instance）
  ↓
自动流转到第一个节点
  ↓
通知对应审批人
```

### **流程 3: 处理审批**
```
审批人登录系统
  ↓
查看待审批列表
  ↓
点击查看详情
  ↓
填写审批意见
  ↓
选择通过/拒绝
  ↓
条件判断引擎计算下一节点
  ↓
自动流转 OR 结束流程
  ↓
更新审批历史
```

流程 4: 条件判断引擎

```
// 示例：金额 > 1000 时进入财务审批
checkConditions(conditions, formData) {
  conditions.forEach(condition => {
    const fieldValue = parseFloat(formData[condition.field]);
    const conditionValue = parseFloat(condition.value);
    
    switch (condition.operator) {
      case '>': return fieldValue > conditionValue;
      case '<': return fieldValue < conditionValue;
      case '==': return fieldValue === conditionValue;
      // ...
    }
  });
}
```

---

## 🎨 UI 模块功能

### **模块 1: 流程设计中心**

**NodeEditor（节点编辑器）**
- ✅ 添加/删除节点
- ✅ 拖拽排序（上移/下移）
- ✅ 实时编辑节点名称
- ✅ 节点选中高亮
- ✅ 显示审批人和条件数量

**ConditionEditor（条件配置器）**
- ✅ 审批人选择（支持多选）
- ✅ 流转条件配置（字段、操作符、值）
- ✅ 条件列表展示和删除
- ✅ 用户选择器组件

**FlowVisualization（流程可视化）**
- ✅ 水平时间线展示
- ✅ 起始/结束节点标识
- ✅ 节点连接箭头
- ✅ 条件标记（黄色标签）
- ✅ 审批人信息展示

### **模块 2: 审批中心**

**待我审批**
- ✅ 显示需要当前用户审批的实例
- ✅ 红色角标提示待审批数量
- ✅ 一键通过/拒绝
- ✅ 审批意见填写

**我的申请**
- ✅ 显示当前用户发起的所有申请
- ✅ 实时状态追踪
- ✅ 审批进度查看

**全部审批**
- ✅ 显示系统所有审批实例
- ✅ 状态筛选（待审批/已通过/已拒绝）

### **模块 3: 审批详情**

**ApprovalProgress（审批进度）**
- ✅ 申请信息展示（编号、类型、申请人、时间）
- ✅ 表单数据展示（标题、金额、说明）
- ✅ 当前状态高亮
- ✅ 审批操作区（待审批时显示）
- ✅ 时间线展示审批历史
- ✅ 每个节点的审批人、时间、意见

### **模块 4: 申请表单**

**CreateApplicationForm**
- ✅ 动态表单（根据申请类型显示不同字段）
- ✅ 报销申请：金额字段
- ✅ 请假申请：开始日期、结束日期、天数
- ✅ 合同审批：合同金额
- ✅ 采购申请：采购金额
- ✅ 表单验证
- ✅ 弹窗模式

---

## 👥 用户身份系统

### **预设用户（7个测试账号）**

| ID | 姓名 | 角色 | 部门 |
|----|------|------|------|
| u1 | 张三 | 员工 | 技术部 |
| u2 | 李四 | 部门主管 | 技术部 |
| u3 | 王五 | 财务 | 财务部 |
| u4 | 赵六 | 总经理 | 管理层 |
| u5 | 钱七 | 员工 | 市场部 |
| u6 | 孙八 | 部门主管 | 市场部 |
| u7 | 周九 | HR | 人力资源部 |

### **用户切换功能**
- 右上角下拉菜单切换用户
- 自动刷新待审批列表
- 模拟真实多角色场景

---

## ✅ 完整功能自检清单

### **流程配置功能** ✅
- [x] 创建流程并命名
- [x] 添加/删除审批节点
- [x] 编辑节点信息
- [x] 拖拽排序节点
- [x] 配置审批人（多选）
- [x] 设置流转条件
- [x] 保存流程到数据库
- [x] 流程可视化预览
- [x] 发起审批按钮

### **审批实例功能** ✅
- [x] 填写申请表单
- [x] 创建审批实例
- [x] 自动流转到第一个节点
- [x] 记录发起人和时间
- [x] 存储表单数据
- [x] 生成唯一实例ID

### **审批处理功能** ✅
- [x] 查看待审批列表
- [x] 待审批数量角标
- [x] 审批详情查看
- [x] 填写审批意见
- [x] 通过操作
- [x] 拒绝操作（必填意见）
- [x] 自动流转判断
- [x] 条件引擎计算
- [x] 更新审批状态
- [x] 记录审批历史

### **审批进度功能** ✅
- [x] 实例基本信息
- [x] 表单数据展示
- [x] 当前状态显示
- [x] 时间线可视化
- [x] 历史记录展示
- [x] 审批人信息
- [x] 审批时间
- [x] 审批意见
- [x] 状态图标（通过/拒绝/待审）

### **用户身份功能** ✅
- [x] 用户切换
- [x] 当前用户显示
- [x] 权限判断（只能审批分配给自己的）
- [x] 我的申请列表
- [x] 待我审批列表

### **条件路由功能** ✅
- [x] 字段值比较
- [x] 支持 ==, >, <, >=, <=
- [x] 自动跳过不满足条件的节点
- [x] 条件链式判断
- [x] 无符合节点时自动完成

---

## 🎮 使用场景演示

### **场景 1: 报销审批流程**

1. **张三（员工）**发起 1500 元报销申请
2. 系统自动流转到**李四（部门主管）**
3. 李四审批通过
4. 因金额 > 1000，自动流转到**王五（财务）**
5. 王五审批通过
6. 流程结束，状态变为"已通过"

### **场景 2: 请假审批流程**

1. **钱七（市场部员工）**发起 3 天请假申请
2. 流转到**孙八（市场部主管）**
3. 孙八审批拒绝并填写"人手不足"
4. 流程结束，状态变为"已拒绝"

---

## 🔥 技术亮点

1. **真实的数据流**：完整的 CRUD 操作
2. **状态机设计**：基于状态的流程引擎
3. **条件路由**：智能判断下一节点
4. **时间线展示**：直观的审批历史
5. **角色权限**：基于用户身份的权限控制
6. **响应式 UI**：现代化的界面设计
7. **实时更新**：操作后立即反映到列表
8. **数据持久化**：内存数据库模拟

---

## 📊 数据流图
```
用户操作
  ↓
UI 组件
  ↓
事件处理函数
  ↓
Database API 调用
  ↓
业务逻辑处理
  ↓
数据更新
  ↓
React State 更新
  ↓
UI 重新渲染
```
